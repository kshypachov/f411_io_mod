# F411 IO Mod Project

This project is designed to run on the STM32F411CEUX microcontroller, handling input/output control, networking, and MQTT-based communication. The application interfaces with sensors and actuators, updates statuses in Home Assistant, and uses FreeRTOS to manage concurrent tasks.

## Features

- **MQTT Communication**: Publishes sensor data and subscribes to commands using MQTT, supporting integration with Home Assistant.
- **FreeRTOS Tasks**: Implements separate tasks for Ethernet management, IO control, display updates, and settings management.
- **Network Management**: Uses the Mongoose networking library to manage TCP/IP and WebSocket connections.
- **Persistent Storage**: Utilizes LittleFS with SPI Flash for settings and file storage.

## Getting Started

### Prerequisites

- STM32CubeIDE with STM32 HAL and CMSIS libraries
- FreeRTOS for task management
- Home Assistant (for MQTT integration)
- Mongoose Library (for network handling)

### Building and Flashing

1. Clone this repository:
    ```bash
    git clone https://github.com/kshypachov/f411_io_mod
    ```

2. Open the project in **STM32CubeIDE** and build.

3. Flash the binary to your STM32F411CEUX microcontroller using a compatible programmer (e.g., ST-Link).

### Configuration

#### MQTT

- Update your MQTT broker URL, username, and password in the `mqtt.cpp` initialization function.

- Ensure that Home Assistant is configured to accept MQTT messages and includes topics generated by the projectâ€™s MQTT configuration.

#### GPIO and IO

- Configure the input/output pins as needed for your application in `freertos.c` or in the STM32CubeMX `.ioc` file.

### Usage

1. **MQTT Integration**: Once connected to a broker, the device will publish sensor data and subscribe to control topics. Configuration data is stored in `/settings/mqtt.conf`.

2. **Tasks**:
   - **Ethernet Task**: Manages MQTT connectivity.
   - **IO Task**: Reads sensor states and controls output relays.
   - **Display Task**: (Future expansion) For displaying data on an attached screen.
   - **Settings Task**: Manages persistent storage and reads configuration from flash memory.

### License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

### Contributions

Contributions are welcome! Please submit issues or pull requests to enhance the functionality or fix bugs.

### Acknowledgments

- [STM32 HAL and CMSIS Libraries](https://www.st.com/)
- [FreeRTOS](https://www.freertos.org/)
- [Mongoose Networking Library](https://www.cesanta.com/)
- [Home Assistant](https://www.home-assistant.io/)

## Contact

For any questions, please reach out via [GitHub Issues](https://github.com/kshypachov/f411_io_mod/issues)